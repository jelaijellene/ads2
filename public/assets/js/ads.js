// Generated by CoffeeScript 1.3.3
(function() {
  var PhoneDetailCtrl, PhoneListCtrl, filters, phonecat;

  phonecat = angular.module('phonecat', ['phonecatFilters']);

  phonecat.config([
    '$routeProvider', function($routeProvider) {
      return $routeProvider.when('/phones', {
        templateUrl: 'partials/phone-list.html',
        controller: PhoneListCtrl
      }).when('/phones/:phoneId', {
        templateUrl: 'partials/phone-detail.html',
        controller: PhoneDetailCtrl
      }).otherwise({
        redirectTo: '/phones'
      });
    }
  ]);

  filters = angular.module('phonecatFilters', []);

  filters.filter('startFrom', function() {
    return function(input, start) {
      if (angular.isArray(input)) {
        return input.slice(start);
      }
      return input;
    };
  });

  PhoneListCtrl = [
    '$scope', '$http', '$filter', function($scope, $http, $filter) {
      $http.get('phones.json').success(function(data) {
        $scope.unfiltered = data;
        $scope.phones = $filter('filter')($scope.unfiltered, $scope.query);
        $scope.numberOfPages = function() {
          return Math.ceil($scope.phones.length / $scope.limit);
        };
        $scope.isLastPage = function() {
          return ($scope.currentPage === $scope.numberOfPages()) || ($scope.numberOfPages() === 0);
        };
        return this;
      });
      $scope.orderProp = 'id';
      $scope.currentPage = 1;
      $scope.limit = 1;
      $scope.start = 0;
      $scope.change = function() {
        console.log("filtered: " + $scope.phones);
        $scope.phones = $filter('filter')($scope.unfiltered, $scope.query);
        $scope.start = 0;
        return $scope.currentPage = 1;
      };
      $scope.nextPage = function() {
        $scope.currentPage++;
        console.log("currentPage: " + $scope.currentPage);
        $scope.start = +$scope.start + +$scope.limit;
        return console.log("start: " + $scope.start);
      };
      $scope.previousPage = function() {
        $scope.currentPage--;
        console.log("currentPage: " + $scope.currentPage);
        $scope.start = +$scope.start - +$scope.limit;
        if ($scope.start < 0) {
          $scope.start = 0;
        }
        console.log("start: " + $scope.start);
        return true;
      };
      $scope.isFirstPage = function() {
        return $scope.currentPage === 1;
      };
      return this;
    }
  ];

  PhoneDetailCtrl = [
    '$scope', '$routeParams', function($scope, $routeParams) {
      $scope.phoneId = $routeParams.phoneId;
      $scope.hello = function(name) {
        return $scope.msg = "hello " + name;
      };
      return this;
    }
  ];

}).call(this);
